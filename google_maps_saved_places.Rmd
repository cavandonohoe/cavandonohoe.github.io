---
title: "Google Maps Saved Places"
output:
  html_document:
    includes:
      in_header: header/header.html
      after_body: include_footer.html
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

This page embeds my Google My Maps layer and shows the latest exported CSV data from the repo.

## Saved Places

```{=html}
<iframe
  src="https://www.google.com/maps/d/embed?mid=1aSjDN50VR8qKu40GyIE2UsF6C8WzhGU&ehbc=2E312F"
  width="640"
  height="480"
  style="border:0;"
  loading="lazy">
</iframe>
```

## Latest CSV Export

This section loads CSV files in the browser, so table content updates whenever `data/*.csv` changes.

```{=html}
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<h3>Saved Places (CSV)</h3>
<div id="saved-places-status">Loading...</div>
<div id="saved-places-table"></div>

<script>
function escapeHtml(value) {
  return String(value ?? "")
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function renderCsvTable(targetId, statusId, csvPath) {
  const statusEl = document.getElementById(statusId);
  const targetEl = document.getElementById(targetId);
  const cacheBuster = Date.now();

  Papa.parse(`${csvPath}?v=${cacheBuster}`, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      const rows = results.data || [];
      if (!rows.length) {
        statusEl.textContent = "No rows found.";
        targetEl.innerHTML = "";
        return;
      }

      const headers = Object.keys(rows[0]);
      const headHtml = headers.map(h => `<th>${escapeHtml(h)}</th>`).join("");
      const bodyHtml = rows.map(row => {
        const cells = headers.map(h => `<td>${escapeHtml(row[h])}</td>`).join("");
        return `<tr>${cells}</tr>`;
      }).join("");

      targetEl.innerHTML = `
        <div style="overflow-x:auto;">
          <table class="table table-striped table-condensed" style="width:100%;">
            <thead><tr>${headHtml}</tr></thead>
            <tbody>${bodyHtml}</tbody>
          </table>
        </div>
      `;
      statusEl.textContent = `Loaded ${rows.length} rows from ${csvPath}.`;
    },
    error: function(err) {
      statusEl.textContent = `Could not load ${csvPath}: ${err.message || err}`;
      targetEl.innerHTML = "";
    }
  });
}

renderCsvTable("saved-places-table", "saved-places-status", "data/saved_places.csv");
</script>
```

## Setup Notes

- Add repo secret `MYMAPS_MID` with your My Maps `mid`.
- The weekly workflow updates these files:
  - `data/saved_places.kml`
  - `data/saved_places.csv`
