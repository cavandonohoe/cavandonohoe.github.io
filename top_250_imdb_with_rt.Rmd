---
title: "Top 250 IMDb Movies with Rotten Tomato Scores"
editor_options: 
  chunk_output_type: console
output:
  html_document:
    includes:
      in_header: header/header.html
      after_body: include_footer.html
---

```{r pipe, include=FALSE}
`%>%` <- magrittr::`%>%`
```

```{r setup, include=FALSE}
# Set default chunk output
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE,
  results = "asis"
)
```

```{r get_data}
top_250_imdb_rot_tom <- readr::read_csv(
  here::here("data", "top250_movies_with_rt.csv"),
  show_col_types = FALSE
) %>%
  dplyr::select(-dplyr::any_of("...1"))

```

I love looking through the Top 250 Movies IMDb list to see which movie I should watch tonight. Some movies really resonate with me and this list contains some of my favorite movies of all time (The Dark Knight, Good Will Hunting, Shawshank Redemption).

This list is missing Baby Driver though, so it's not perfect. 

[Raw Data](data/top250_movies_with_rt.csv)


## Production Companies


Here are our current Top 15 Production Company Leaderboards for the IMDb Top 250 Movies. 


```{r producers_leaderboard}
max_hover_titles <- 20

producer_leaders_data <- top_250_imdb_rot_tom %>%
  tidyr::separate_rows(production_company, sep = "\\|") %>%
  dplyr::group_by(production_company) %>%
  dplyr::summarise(n = dplyr::n(), all_titles = paste(title, collapse = "\n")) %>%
  dplyr::arrange(dplyr::desc(n)) %>%
  dplyr::ungroup() %>%
  dplyr::slice(1:15) %>%
  dplyr::mutate(
    production_company = stats::reorder(production_company, -n),
    hover_titles = vapply(
      strsplit(all_titles, "\n", fixed = TRUE),
      function(titles) {
        if (length(titles) > max_hover_titles) {
          titles <- c(
            titles[1:max_hover_titles],
            paste0("...and ", length(titles) - max_hover_titles, " more")
          )
        }
        paste(titles, collapse = "<br>")
      },
      character(1)
    )
  )

producer_leaders_plot <- producer_leaders_data %>%
  ggplot2::ggplot(ggplot2::aes(y = reorder(production_company, -n), x = n, text = all_titles,
    fill = production_company))+
  ggplot2::geom_col() +
  ggplot2::theme(axis.title.y=ggplot2::element_blank(),
        axis.title.x=ggplot2::element_blank(),
        legend.position = "none") +
  ggplot2::ggtitle("Production Company Leaderboard") +
  ggplot2::geom_text(
    ggplot2::aes(label = n),
    hjust = -0.4,
    position = ggplot2::position_dodge(width = 1)
  ) +
  ggplot2::scale_x_continuous(expand = ggplot2::expansion(mult = c(0, 0.12)))


plotly::plot_ly(
  producer_leaders_data,
  x = ~n,
  y = ~production_company,
  type = "bar",
  orientation = "h",
  color = ~production_company,
  text = ~n,
  textposition = "outside",
  hovertext = ~hover_titles,
  hoverinfo = "text"
) %>%
  plotly::layout(
    xaxis = list(automargin = TRUE, range = c(0, max(producer_leaders_data$n) * 1.15)),
    yaxis = list(automargin = TRUE, title = "Production Company"),
    showlegend = FALSE,
    margin = list(r = 40),
    hoverlabel = list(align = "left")
  )

# add a section for actors and producers dude!

# also just out of curiosity
# top_250_imdb_rot_tom %>%
#   dplyr::filter(grepl(x=producers_imdb, pattern = "focus", ignore.case = TRUE))
```


## Rotten Tomatoes

### Top 250 Sorted By Tomatometer

```{r rt_table}
top_250_imdb_rot_tom %>%
  dplyr::arrange(dplyr::desc(tomato_meter_scores), rank) %>%
  dplyr::select(title, year, tomato_meter_scores, audience_scores, imdb_rating) %>%
  DT::datatable(filter = "top", extensions = "Buttons",
            options = list(paging = FALSE, dom = "Bfrtip", buttons = c("copy", "csv", "excel"),
                           scrollY = "400px", scrollX = TRUE))
```


### Residuals

Turns out, you may know the IMDb score based on the Rotten Tomatoes Score. The residuals point us in the right direction. 

```{r resid_plot_rt_imdb}
resid_plot <- top_250_imdb_rot_tom %>%
  dplyr::mutate(rot_imdb_residual = tomato_meter_scores - imdb_rating * 10,
         label = paste0(title, "\n", "IMDb Rating: ", imdb_rating)) %>%
  ggplot2::ggplot(ggplot2::aes(x = tomato_meter_scores, y = rot_imdb_residual, label = label)) +
  ggplot2::geom_point() + ggplot2::geom_smooth() +
  ggplot2::ggtitle("Residual Predictor") +
  ggplot2::ylab("TomatoMeter - 10 * IMDB Score") +
  ggplot2::xlab("TomatoMeter")

resid_plot %>%
  plotly::ggplotly()

```
